<!doctype html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html xmlns:th="http://www.thymeleaf.org" class="no-js" lang="en">
<!--<![endif]-->

<head th:replace="admin/fragments :: meta_css"></head>
<head>
    <link rel="stylesheet" th:href="@{/admin/vendors/datatables.net-bs4/css/dataTables.bootstrap4.min.css}">
    <link rel="stylesheet" th:href="@{/admin/vendors/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css}">
</head>

<body>


<!-- Left Panel -->
<aside th:replace="admin/fragments :: left-panel"></aside>

<!-- Left Panel -->

<!-- Right Panel -->

<div id="right-panel" class="right-panel">

    <!-- Header-->
    <header th:replace="admin/fragments :: header"></header>
    <!-- /header -->
    <!-- Header-->

    <div class="breadcrumbs">
        <div class="col-sm-4">
            <div class="page-header float-left">
                <div class="page-title">
                    <h1>Đơn hàng</h1>
                </div>
            </div>
        </div>
        <div class="col-sm-8">
            <div class="page-header float-right">
                <div class="page-title">
                    <ol class="breadcrumb text-right">
                        <li class="active">Đơn hàng</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <div class="content mt-3">
        <div class="animated fadeIn">
            <div class="row">

                <div class="col-md-12">

                    <div class="notification-box">

                    </div>

                    <div class="card">
                        <div class="card-header">
                            <strong class="card-title">Đơn hàng</strong>
                        </div>
                                <div class="col-sm-8 hidden-sm-down" style="margin-top: 2%">
<!--                                    <button type="button" class="btn btn-primary float-right bg-flat-color-1"><i class="fa fa-cloud-download"></i></button>-->
                                    <div class="btn-toolbar float-right" role="toolbar" aria-label="Toolbar with button groups">
                                        <div class="btn-group mr-3" data-toggle="buttons" aria-label="First group">
                                            <label class="btn btn-outline-secondary">
                                                <input type="radio" name="options" value="all" id="option1"> Tất cả
                                            </label>
                                            <label class="btn btn-outline-secondary active">
                                                <input type="radio" name="options" value="delivered" id="option2" checked=""> Đã giao
                                            </label>
                                            <label class="btn btn-outline-secondary">
                                                <input type="radio" name="options" value="pending" id="option3"> Chưa duyệt
                                            </label>
                                        </div>
                                    </div>
                                </div>
                        <div class="card-body">
                            <table id="bootstrap-data-table-export" class="table table-striped table-bordered">
                                <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Thời gian</th>
                                    <th>Phương thức thanh toán</th>
                                    <th>Trạng thái</th>
                                    <th>Nhân viên</th>
                                    <th>Chức năng</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="order : ${orderList}">
                                    <td th:text="${order.orderId}"></td>
                                    <td th:text="${#temporals.format(order.date, 'HH:mm:ss dd-MM-yyyy')}"></td>
                                    <td th:text="${order.paymentMethod}"></td>
                                    <td th:text="${order.status}"></td>
                                    <td th:text="${order.staff.name}"></td>

                                    <td style="display: inline-flex;">
<!--                                        <button type="button" class="btn btn-danger"-->
<!--                                                data-toggle="modal"-->
<!--                                                th:data-target="|#deletemodal${order.orderId}|">-->
<!--                                            <i class="fa fa-trash-o"></i>-->
<!--                                        </button>-->


                                        <div th:if="${!order.status}">
                                            <a th:href="@{/admin/order/update-order/{id}(id=${order.orderId})}">
                                                <button th:data-id="${order.orderId}" id="approveBtn" type="button" class="btn btn-success">
                                                    Chấp thuận</button>
                                            </a>
                                        </div>
                                        <div th:if="${order.status}">
                                            <button type="button" class="btn btn-secondary disabled" style="pointer-events: none;">
                                                Chấp thuận</button>
                                        </div>

                                        <a th:href="@{/admin/order/order-list/{id}(id=${order.orderId})}">
                                            <button type="button" class="btn btn-primary">
                                                <i class="fa fa-eye"></i>
                                            </button>
                                        </a>



                                        <!--                                        <div class="modal fade" th:id="'deletemodal' + ${order.orderId}" tabindex="-1" role="dialog" aria-labelledby="smallmodalLabel" aria-hidden="true">-->
<!--                                            <div class="modal-dialog modal-sm" role="document">-->
<!--                                                <div class="modal-content">-->
<!--                                                    <div class="modal-header">-->
<!--                                                        <h5 class="modal-title" id="smallmodalLabel">Thông báo</h5>-->
<!--                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">-->
<!--                                                            <span aria-hidden="true">&times;</span>-->
<!--                                                        </button>-->
<!--                                                    </div>-->
<!--                                                    <div class="modal-body">-->
<!--                                                        <p>Bạn có chắc muốn xóa?</p>-->
<!--                                                    </div>-->
<!--                                                    <div class="modal-footer">-->
<!--                                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>-->
<!--                                                        <a th:href="@{/admin/order/delete/{id}(id=${order.orderId})}">-->
<!--                                                            <button type="button" class="btn btn-primary">Xác nhận</button>-->
<!--                                                        </a>-->
<!--                                                    </div>-->
<!--                                                </div>-->
<!--                                            </div>-->
<!--                                        </div>-->


                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


            </div>
        </div><!-- .animated -->
    </div><!-- .content -->
</div><!-- /#right-panel -->

<!-- Right Panel -->

<script th:src="@{/admin/assets/js/base.js}"></script>
<script th:src="@{/admin/assets/js/indexAdmin.js}"></script>

<script th:src="@{/admin/vendors/jquery/dist/jquery.min.js}"></script>
<script th:src="@{/admin/vendors/popper.js/dist/umd/popper.min.js}"></script>
<script th:src="@{/admin/vendors/bootstrap/dist/js/bootstrap.min.js}"></script>
<script th:src="@{/admin/assets/js/main.js}"></script>

<script th:inline="javascript">
    var notificationType = '';
    var notificationMessage = '';
    notificationType = [[${notificationType}]];
    notificationMessage = [[${notificationMessage}]]

    if (notificationType && notificationMessage) {
        sendNotification(notificationType, notificationMessage);
    }

    $(document).ready(function() {
    var table = $('#bootstrap-data-table-export').DataTable();

    function loadOrders(status) {
        $.ajax({
            url: '/admin/api/orders/filter',
            method: 'GET',
            data: { status: status },
            success: function(response) {
                // Xóa dữ liệu cũ
                table.clear();

                // Thêm dữ liệu mới
                response.forEach(function(order) {
                    table.row.add([
                        order.orderId,
                        formatDate(order.date), // Cần viết hàm formatDate
                        order.paymentMethod,
                        order.status,
                        order.staff.name,
                        createActionButtons(order) // Cần viết hàm tạo các nút
                    ]);
                });

                // Vẽ lại bảng
                table.draw();
            },
            error: function(xhr, status, error) {
                console.error('Error loading orders:', error);
            }
        });
    }

    // Hàm format ngày giờ
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleString('vi-VN');
    }

    // Hàm tạo các nút chức năng
    function createActionButtons(order) {
        let buttons = '<div style="display: inline-flex;">';

        // Nút Chấp thuận
        if (!order.status) {
            buttons += `
                <a href="/admin/order/update-order/${order.orderId}">
                    <button data-id="${order.orderId}" class="btn btn-success">Chấp thuận</button>
                </a>`;
        } else {
            buttons += `
                <button class="btn btn-secondary disabled" style="pointer-events: none;">Chấp thuận</button>`;
        }

        // Nút Xem chi tiết
        buttons += `
            <a href="/admin/order/order-list/${order.orderId}">
                <button type="button" class="btn btn-primary">
                    <i class="fa fa-eye"></i>
                </button>
            </a>`;

        buttons += '</div>';
        return buttons;
    }

    // Xử lý sự kiện khi radio button thay đổi
    $('input[name="options"]').on('change', function() {
        const selectedValue = $(this).val();
        loadOrders(selectedValue);
    });

    // Load dữ liệu ban đầu (đã giao)
    loadOrders('delivered');
});
</script>

<script th:src="@{/admin/vendors/datatables.net/js/jquery.dataTables.min.js}"></script>
<script th:src="@{/admin/vendors/datatables.net-bs4/js/dataTables.bootstrap4.min.js}"></script>
<script th:src="@{/admin/vendors/datatables.net-buttons/js/dataTables.buttons.min.js}"></script>
<script th:src="@{/admin/vendors/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js}"></script>
<script th:src="@{/admin/vendors/jszip/dist/jszip.min.js}"></script>
<script th:src="@{/admin/vendors/pdfmake/build/pdfmake.min.js}"></script>
<script th:src="@{/admin/vendors/pdfmake/build/vfs_fonts.js}"></script>
<script th:src="@{/admin/vendors/datatables.net-buttons/js/buttons.html5.min.js}"></script>
<script th:src="@{/admin/vendors/datatables.net-buttons/js/buttons.print.min.js}"></script>
<script th:src="@{/admin/vendors/datatables.net-buttons/js/buttons.colVis.min.js}"></script>
<script th:src="@{/admin/assets/js/init-scripts/data-table/datatables-init.js}"></script>


</body>

</html>
